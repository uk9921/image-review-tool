<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å›¾ç‰‡å’Œè§†é¢‘å±•ç¤ºä¸é€‰æ‹©</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            color: #333;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
        }
        /* é¡¶éƒ¨å·¥å…·æ æ ·å¼ */
        .toolbar {
            background-color: #fff;
            padding: 10px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .toolbar .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }
        .toolbar label {
            margin-right: 5px;
            font-weight: bold;
        }
        .toolbar input[type="text"],
        .toolbar input[type="number"],
        .toolbar textarea {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
            max-width: 100%;
            box-sizing: border-box;
        }
        .toolbar textarea {
            resize: vertical;
            height: 60px;
        }
        .toolbar button {
            padding: 7px 12px;
            border: none;
            border-radius: 4px;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        .toolbar button:hover {
            background-color: #0056b3;
        }
        .toolbar button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        /* å†…å®¹å®¹å™¨æ ·å¼ */
        #container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* é»˜è®¤å“åº”å¼ */
            gap: 20px;
            padding: 20px;
        }
        .media-item {
            position: relative;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            height: 100%; /* ä½¿åª’ä½“é¡¹é«˜åº¦ä¸€è‡´ */
        }
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        /* åª’ä½“å…ƒç´ æ ·å¼ */
        .media-content {
            width: 100%;
            height: auto;
            display: block;
            flex-grow: 1;
            object-fit: cover; /* ç¡®ä¿åª’ä½“å†…å®¹å¡«æ»¡å®¹å™¨ä¸”ä¿æŒæ¯”ä¾‹ */
        }
        .text-content {
            padding: 10px;
            white-space: pre-wrap;
            word-break: break-word;
            flex-grow: 1;
        }
        /* å–‡å­æŒ‰é’®æ ·å¼ */
        .audio-button {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 5px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s, background-color 0.3s;
            pointer-events: auto; /* ç¡®ä¿æŒ‰é’®å¯ç‚¹å‡» */
            width: 30px;
            height: 30px;
            font-size: 16px;
        }
        .video-container:hover .audio-button {
            opacity: 1; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæŒ‰é’® */
        }
        /* å¤é€‰æ¡†å®¹å™¨æ ·å¼ */
        .checkbox-container {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 2px;
        }
        .checkbox-container input[type="checkbox"] {
            transform: scale(1.2);
            cursor: pointer;
        }
        /* åé¦ˆæ¶ˆæ¯æ ·å¼ */
        #feedback {
            text-align: center;
            margin: 10px 0;
            color: green;
            font-weight: bold;
        }
        /* å¯¼å‡ºåŒºåŸŸæ ·å¼ */
        #output {
            width: calc(100% - 40px);
            margin: 0 20px 20px 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
            box-sizing: border-box;
            height: 100px;
        }
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 800px) {
            .toolbar .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .toolbar input[type="text"],
            .toolbar input[type="number"],
            .toolbar textarea {
                width: 100%;
            }
            #output {
                width: calc(100% - 40px);
            }
        }
    </style>
</head>
<body>
    <h1>å›¾ç‰‡å’Œè§†é¢‘å±•ç¤ºä¸é€‰æ‹©</h1>
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="toolbar">
        <div class="controls">
            <div>
                <label for="input">åª’ä½“é“¾æ¥ï¼š</label><br>
                <textarea id="input" placeholder="æ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œä¾‹å¦‚ï¼š
https://example.com/image1.jpg
https://example.com/video1.mp4"></textarea>
            </div>
            <div>
                <label for="filterInput">ç­›é€‰ï¼ˆæ­£åˆ™ï¼‰ï¼š</label><br>
                <input type="text" id="filterInput" placeholder="ä¾‹å¦‚ï¼š\.jpg$">
                <button onclick="filterImages()">ç­›é€‰å›¾ç‰‡</button>
            </div>
            <div>
                <button onclick="loadImages()">åŠ è½½åª’ä½“</button>
                <button onclick="prevPage()" id="prevButton" disabled>ä¸Šä¸€é¡µ</button>
                <button onclick="nextPage()" id="nextButton" disabled>ä¸‹ä¸€é¡µ</button>
                <button id="exportButton" onclick="exportImages()" disabled>å¯¼å‡ºé€‰ä¸­é“¾æ¥</button>
            </div>
            <div>
                <label for="pageSizeInput">æ¯é¡µæ•°é‡ï¼š</label><br>
                <input type="number" id="pageSizeInput" placeholder="ä¾‹å¦‚ï¼š8" min="1">
            </div>
            <div>
                <label for="lineSizeInput">æ¯è¡Œæ•°é‡ï¼š</label><br>
                <input type="number" id="lineSizeInput" placeholder="ä¾‹å¦‚ï¼š4" min="1">
            </div>
            <div>
                <label for="goToPageInput">è·³è½¬åˆ°é¡µç ï¼š</label><br>
                <input type="text" id="goToPageInput" placeholder="ä¾‹å¦‚ï¼š2">
            </div>
        </div>
    </div>
    <!-- å½“å‰é¡µæ•°æ˜¾ç¤º -->
    <p style="text-align:center;">å½“å‰ç¬¬<span id="current">0</span>é¡µï¼Œå…±<span id="total">0</span>é¡µ</p>
    <!-- åª’ä½“å†…å®¹å®¹å™¨ -->
    <div id="container"></div>
    <!-- å¯¼å‡ºé“¾æ¥åŒºåŸŸ -->
    <p style="text-align:center;">å¯¼å‡ºçš„é“¾æ¥ï¼š</p>
    <textarea id="output" readonly></textarea>
    <!-- åé¦ˆæ¶ˆæ¯ -->
    <div id="feedback"></div>

    <script>
        (function() {
            // å®šä¹‰å˜é‡
            let images = [];
            let currentPage = 1;
            let pageSize = 8;
            let lineSize = 4;
            let totalPages = 0;
            const selectedImages = new Set(); // ä½¿ç”¨ Set é¿å…é‡å¤

            // DOMå…ƒç´ ç¼“å­˜
            const inputTextArea = document.getElementById("input");
            const filterInput = document.getElementById("filterInput");
            const container = document.getElementById("container");
            const currentSpan = document.getElementById("current");
            const totalSpan = document.getElementById("total");
            const prevButton = document.getElementById("prevButton");
            const nextButton = document.getElementById("nextButton");
            const exportButton = document.getElementById("exportButton");
            const outputTextArea = document.getElementById("output");
            const feedbackDiv = document.getElementById("feedback");

            // åŠ è½½åª’ä½“å‡½æ•°
            window.loadImages = function() {
                const text = inputTextArea.value.replace(/\t/g, "\n");
                const lines = text.split("\n").map(line => line.trim()).filter(line => line !== "");
                images = lines;
                currentPage = 1;
                totalPages = Math.ceil(images.length / pageSize);
                updatePagination();
                renderImages();
                showFeedback(`åŠ è½½äº† ${images.length} ä¸ªåª’ä½“é“¾æ¥ã€‚`);
            };

            // æ¸²æŸ“åª’ä½“
            function renderImages() {
                container.innerHTML = "";

                if (images.length === 0) {
                    container.innerHTML = "<p style='text-align:center;'>æ²¡æœ‰è¦æ˜¾ç¤ºçš„å›¾ç‰‡æˆ–è§†é¢‘ã€‚</p>";
                    return;
                }

                const startIndex = (currentPage - 1) * pageSize;
                const endIndex = Math.min(currentPage * pageSize, images.length);
                const currentImages = images.slice(startIndex, endIndex);

                currentImages.forEach((url) => {
                    const mediaItem = createMediaItem(url);
                    container.appendChild(mediaItem);
                });

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                prevButton.disabled = currentPage === 1;
                nextButton.disabled = currentPage === totalPages;
                updateExportButton();
            }

            // åˆ›å»ºåª’ä½“é¡¹
            function createMediaItem(url) {
                const div = document.createElement("div");
                div.className = "media-item";

                let mediaElement;
                let audioButton = null;

                if (isJsonString(url)) {
                    mediaElement = createTextContent(JSON.parse(url));
                } else if (isVideo(url)) {
                    const videoContainer = document.createElement("div");
                    videoContainer.className = "video-container";
                    videoContainer.style.position = "relative"; // ç¡®ä¿ç›¸å¯¹å®šä½

                    const video = document.createElement("video");
                    video.src = url;
                    video.autoplay = true;
                    video.muted = true;
                    video.loop = true;
                    video.className = "media-content";
                    video.setAttribute("aria-label", "Video content");

                    // åˆ›å»ºå–‡å­æŒ‰é’®
                    audioButton = createAudioButton(video);
                    videoContainer.appendChild(video);
                    videoContainer.appendChild(audioButton);
                    mediaElement = videoContainer;
                } else if (isImage(url)) {
                    mediaElement = createImage(url);
                } else {
                    mediaElement = createTextContent(url);
                }

                // å¤é€‰æ¡†å®¹å™¨
                const checkboxContainer = document.createElement("div");
                checkboxContainer.className = "checkbox-container";

                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.value = url;
                checkbox.setAttribute("aria-label", "é€‰æ‹©åª’ä½“");

                // åˆå§‹åŒ–å¤é€‰æ¡†çŠ¶æ€
                if (selectedImages.has(url)) {
                    checkbox.checked = true;
                }

                // å¤é€‰æ¡†äº‹ä»¶å¤„ç†
                checkbox.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (checkbox.checked) {
                        selectedImages.add(url);
                    } else {
                        selectedImages.delete(url);
                    }
                    updateExportButton();
                });

                checkboxContainer.appendChild(checkbox);
                div.appendChild(mediaElement);
                div.appendChild(checkboxContainer);

                // åª’ä½“å…ƒç´ ç‚¹å‡»äº‹ä»¶ï¼Œåˆ‡æ¢å¤é€‰æ¡†
                mediaElement.addEventListener("click", () => {
                    checkbox.checked = !checkbox.checked;
                    if (checkbox.checked) {
                        selectedImages.add(url);
                    } else {
                        selectedImages.delete(url);
                    }
                    updateExportButton();
                });

                return div;
            }

            // åˆ›å»ºæ–‡æœ¬å†…å®¹
            function createTextContent(text) {
                const textDiv = document.createElement("div");
                textDiv.className = "text-content";
                textDiv.textContent = text;
                textDiv.setAttribute("aria-label", "æ–‡æœ¬å†…å®¹");
                return textDiv;
            }

            // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
            function createImage(src) {
                const img = document.createElement("img");
                img.src = src;
                img.className = "media-content";
                img.alt = "å›¾ç‰‡å†…å®¹";
                return img;
            }

            // åˆ›å»ºéŸ³é¢‘æŒ‰é’®
            function createAudioButton(video) {
                const button = document.createElement("button");
                button.className = "audio-button";
                button.innerHTML = "ğŸ”‡";
                button.setAttribute("aria-label", "åˆ‡æ¢å£°éŸ³");

                button.addEventListener("click", (e) => {
                    e.stopPropagation();
                    video.muted = !video.muted;
                    button.innerHTML = video.muted ? "ğŸ”‡" : "ğŸ”Š";
                });

                return button;
            }

            // è®¾ç½®æ¯é¡µæ•°é‡
            const pageSizeInput = document.getElementById("pageSizeInput");
            pageSizeInput.addEventListener("change", (e) => {
                const val = parseInt(e.target.value);
                if (!isNaN(val) && val > 0) {
                    pageSize = val;
                    totalPages = Math.ceil(images.length / pageSize);
                    currentPage = Math.min(currentPage, totalPages);
                    updatePagination();
                    renderImages();
                    showFeedback(`æ¯é¡µæ˜¾ç¤ºæ•°é‡è®¾ç½®ä¸º ${pageSize}ã€‚`);
                } else {
                    showFeedback("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¯é¡µæ•°é‡ï¼ˆå¤§äº0ï¼‰ã€‚", true);
                }
            });

            // è®¾ç½®æ¯è¡Œæ•°é‡
            const lineSizeInput = document.getElementById("lineSizeInput");
            lineSizeInput.addEventListener("change", (e) => {
                const val = parseInt(e.target.value);
                if (!isNaN(val) && val > 0) {
                    lineSize = val;
                    // æ ¹æ® lineSize è°ƒæ•´ CSS Grid åˆ—æ•°
                    container.style.gridTemplateColumns = `repeat(${lineSize}, 1fr)`;
                    showFeedback(`æ¯è¡Œæ˜¾ç¤ºæ•°é‡è®¾ç½®ä¸º ${lineSize}ã€‚`);
                } else {
                    showFeedback("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¯è¡Œæ•°é‡ï¼ˆå¤§äº0ï¼‰ã€‚", true);
                }
            });

            // è·³è½¬åˆ°æŒ‡å®šé¡µç 
            const goToPageInput = document.getElementById("goToPageInput");
            goToPageInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    const page = parseInt(e.target.value);
                    if (!isNaN(page) && page >= 1 && page <= totalPages) {
                        currentPage = page;
                        updatePagination();
                        renderImages();
                        showFeedback(`è·³è½¬åˆ°ç¬¬ ${page} é¡µã€‚`);
                        e.target.value = "";
                    } else {
                        showFeedback("æ— æ•ˆçš„é¡µç ï¼Œè¯·è¾“å…¥æ­£ç¡®çš„æ•°å­—ã€‚", true);
                    }
                }
            });

            // ä¸Šä¸€é¡µ
            window.prevPage = function() {
                if (currentPage > 1) {
                    currentPage--;
                    updatePagination();
                    renderImages();
                }
            };

            // ä¸‹ä¸€é¡µ
            window.nextPage = function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    updatePagination();
                    renderImages();
                }
            };

            // å¯¼å‡ºé€‰ä¸­çš„å›¾ç‰‡/è§†é¢‘é“¾æ¥
            window.exportImages = function() {
                if (selectedImages.size === 0) {
                    showFeedback("æ²¡æœ‰é€‰æ‹©ä»»ä½•åª’ä½“é“¾æ¥ã€‚", true);
                    return;
                }
                const exported = Array.from(selectedImages).join("\n");
                outputTextArea.value = exported;
                // è‡ªåŠ¨é€‰æ‹©å¹¶å¤åˆ¶ï¼ˆå¯é€‰ï¼‰
                outputTextArea.select();
                document.execCommand("copy");
                showFeedback("å·²å¤åˆ¶é€‰ä¸­çš„é“¾æ¥åˆ°å‰ªè´´æ¿ï¼");
            };

            // ç­›é€‰å›¾ç‰‡
            window.filterImages = function() {
                const regexStr = filterInput.value.trim();
                if (!regexStr) {
                    showFeedback("è¯·è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œç­›é€‰ã€‚", true);
                    return;
                }
                try {
                    const regex = new RegExp(regexStr, 'i');
                    const filteredImages = images.filter(url => regex.test(url));
                    if (filteredImages.length === 0) {
                        showFeedback("ç­›é€‰ç»“æœä¸ºç©ºï¼Œæ²¡æœ‰åŒ¹é…çš„åª’ä½“é“¾æ¥ã€‚", true);
                    } else {
                        images = filteredImages;
                        currentPage = 1;
                        totalPages = Math.ceil(images.length / pageSize);
                        updatePagination();
                        renderImages();
                        showFeedback(`ç­›é€‰åå‰©ä½™ ${images.length} ä¸ªåª’ä½“é“¾æ¥ã€‚`);
                    }
                } catch (error) {
                    showFeedback("æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚", true);
                }
            };

            // æ›´æ–°åˆ†é¡µæ˜¾ç¤º
            function updatePagination() {
                currentSpan.textContent = currentPage;
                totalSpan.textContent = totalPages;
            }

            // æ›´æ–°å¯¼å‡ºæŒ‰é’®æ–‡æœ¬
            function updateExportButton() {
                if (selectedImages.size > 0) {
                    exportButton.innerHTML = `å¯¼å‡ºé€‰ä¸­é“¾æ¥ (${selectedImages.size})`;
                    exportButton.disabled = false;
                } else {
                    exportButton.innerHTML = 'å¯¼å‡ºé€‰ä¸­é“¾æ¥';
                    exportButton.disabled = true;
                }
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºJSONå­—ç¬¦ä¸²
            function isJsonString(str) {
                try {
                    JSON.parse(str);
                } catch (e) {
                    return false;
                }
                return true;
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºè§†é¢‘æ–‡ä»¶
            function isVideo(url) {
                // å…è®¸è§†é¢‘URLæœ«å°¾æœ‰æŸ¥è¯¢å‚æ•°
                return /\.(mp4|webm|ogg)(\?.*)?$/i.test(url);
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
            function isImage(url) {
                return /\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(url);
            }

            // æ˜¾ç¤ºåé¦ˆæ¶ˆæ¯
            function showFeedback(message, isError = false) {
                feedbackDiv.textContent = message;
                feedbackDiv.style.color = isError ? 'red' : 'green';
                setTimeout(() => {
                    feedbackDiv.textContent = '';
                }, 3000);
            }

            // åˆå§‹åŒ–é¡µé¢
            document.addEventListener("DOMContentLoaded", () => {
                // é»˜è®¤è®¾ç½® grid-template-columns ä¸ºè‡ªåŠ¨å¡«å……ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ lineSize è°ƒæ•´
                container.style.gridTemplateColumns = `repeat(auto-fill, minmax(200px, 1fr))`;
            });

            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(event) {
                if (event.target.tagName.toLowerCase() === 'input' || event.target.tagName.toLowerCase() === 'textarea') {
                    return; // ä¸åœ¨è¾“å…¥æ¡†æ—¶æ‰å“åº”
                }
                if (event.key === 'ArrowLeft') { // å·¦ç®­å¤´é”®
                    prevPage();
                } else if (event.key === 'ArrowRight') { // å³ç®­å¤´é”®
                    nextPage();
                }
            });
        })();
    </script>
</body>
</html>
