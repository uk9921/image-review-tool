<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .content-box {
            width: 200px; /* æ¯ä¸ªcontent boxçš„å®½åº¦ */
            margin: 10px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            display: inline-block; /* ä»å·¦å‘å³å±•ç¤º */
            vertical-align: top; /* å‚ç›´å¯¹é½ */
        }
        .checkbox {
            margin-right: 10px;
        }
        .content-area {
            display: flex;
            flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
        }
        /* æ–°å¢æ ·å¼ï¼šå–‡å­æŒ‰é’® */
        .audio-button {
            margin-top: 5px;
            padding: 5px 10px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
    <script>
    //å®šä¹‰ä¸€ä¸ªæ•°ç»„å­˜å‚¨å›¾ç‰‡é“¾æ¥
    var images = [];
    //å®šä¹‰ä¸€ä¸ªå˜é‡å­˜å‚¨å½“å‰é¡µæ•°
    var currentPage = 1;
    //å®šä¹‰ä¸€ä¸ªå˜é‡å­˜å‚¨æ¯é¡µæ˜¾ç¤ºçš„å›¾ç‰‡æ•°é‡
    var pageSize = 8;
    var newPageSize = 8;
    var lineSize = 4;
    var newLineSize = 4;
    //å®šä¹‰ä¸€ä¸ªå˜é‡å­˜å‚¨æ€»é¡µæ•°
    var totalPages = 0;
    //å®šä¹‰ä¸€ä¸ªæ•°ç»„å­˜å‚¨è¢«é€‰ä¸­çš„å›¾ç‰‡é“¾æ¥
    var selectedImages = [];
    //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºä»æ–‡æœ¬æ¡†ä¸­è¯»å–å›¾ç‰‡é“¾æ¥ï¼Œå¹¶æ·»åŠ åˆ°æ•°ç»„ä¸­
    function loadImages(newPageSize) {
      //è·å–æ–‡æœ¬æ¡†çš„å†…å®¹
      var text = document.getElementById("input").value;
      //æŒ‰æ¢è¡Œç¬¦åˆ†å‰²æ–‡æœ¬ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„
      text = text.replace(/\t/g, "\n");
      var lines = text.split("\n");
      //éå†å­—ç¬¦ä¸²æ•°ç»„ï¼Œå°†æ¯ä¸ªå…ƒç´ æ·»åŠ åˆ°å›¾ç‰‡æ•°ç»„ä¸­
      images = [];
      for (var i = 0; i < lines.length; i++) {
        // å»é™¤æ¯è¡Œçš„å‰åç©ºç™½
        var trimmedLine = lines[i].trim();
        if (trimmedLine !== "") {
          images.push(trimmedLine);
        }
      }
      //è®¡ç®—æ€»é¡µæ•°ï¼Œå‘ä¸Šå–æ•´
      pageSize = newPageSize || pageSize;  // å¦‚æœæä¾›äº†æ–°é¡µé¢å¤§å°åˆ™ä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
      totalPages = Math.ceil(images.length / pageSize);
      //æ›´æ–°æ€»é¡µæ•°çš„æ˜¾ç¤º
      document.getElementById("total").innerHTML = totalPages;
      //è°ƒç”¨æ˜¾ç¤ºå›¾ç‰‡çš„å‡½æ•°ï¼Œä¼ å…¥ç¬¬ä¸€é¡µä½œä¸ºå‚æ•°
      showImages(1, pageSize, lineSize);
    }
    // æ–°å¢ä¸€ä¸ªå‡½æ•°æ¥è®¾ç½®æ¯é¡µå›¾ç‰‡æ•°é‡
    function setPageSize(newPageSize) {
      if (isNaN(newPageSize) || newPageSize <= 0) return;
      // è®¡ç®—æ–°çš„å½“å‰é¡µæ•°
      var oldPageIndex = (currentPage - 1) * pageSize + 1;
      var newPageIndex = Math.floor((oldPageIndex - 1) / newPageSize) + 1;
      totalPages = Math.ceil(images.length / newPageSize);
      //æ›´æ–°æ€»é¡µæ•°çš„æ˜¾ç¤º
      document.getElementById("total").innerHTML = totalPages;
      // ç¡®ä¿æ–°çš„é¡µæ•°åœ¨æœ‰æ•ˆèŒƒå›´å†…
      if (newPageIndex > totalPages) {
        newPageIndex = totalPages;
      }
      currentPage = newPageIndex;
      pageSize = parseInt(newPageSize);
      showImages(currentPage, pageSize, lineSize);
    }
    // æ–°å¢ä¸€ä¸ªå‡½æ•°æ¥è®¾ç½®æ¯é¡µå›¾ç‰‡æ•°é‡
    function setLineSize(newLineSize) {
      if (isNaN(newLineSize) || newLineSize <= 0) return;
      newLineSize = parseInt(newLineSize);
      lineSize = newLineSize;
      showImages(currentPage, pageSize, lineSize);
    }
    // æ–°å¢ä¸€ä¸ªå‡½æ•°æ¥è·³è½¬åˆ°æŒ‡å®šé¡µé¢
    function goToPage(page) {
      if (isNaN(page) || page < 1 || page > totalPages) return;
      currentPage = parseInt(page);
      showImages(currentPage, pageSize, lineSize);
    }
    //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ ¹æ®é¡µæ•°æ˜¾ç¤ºå›¾ç‰‡
    function showImages(page, pageSize, lineSize) {
      //è·å–å›¾ç‰‡å®¹å™¨çš„å…ƒç´ 
      var container = document.getElementById("container");
      //æ¸…ç©ºå®¹å™¨çš„å†…å®¹
      container.innerHTML = "";
      //è®¡ç®—å½“å‰é¡µçš„èµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•
      var startIndex = (page - 1) * pageSize;
      var endIndex = Math.min(page * pageSize, images.length);
      //éå†å½“å‰é¡µçš„å›¾ç‰‡é“¾æ¥ï¼Œåˆ›å»ºå›¾ç‰‡å…ƒç´ å¹¶æ·»åŠ åˆ°å®¹å™¨ä¸­
      for (var i = startIndex; i < endIndex; i++) {
        //åˆ›å»ºä¸€ä¸ªdivå…ƒç´ ï¼Œç”¨äºåŒ…è£¹å›¾ç‰‡å’Œå¤é€‰æ¡†
        var div = document.createElement("div");
        div.style.display = "inline-block";
        div.style.margin = "10px";
        div.style.verticalAlign = "top";
        //åˆ›å»ºä¸€ä¸ªimgå…ƒç´ ï¼Œè®¾ç½®å…¶srcå±æ€§ä¸ºå›¾ç‰‡é“¾æ¥
        var mediaElement;
        var audioButton = null; // åˆå§‹åŒ–éŸ³é¢‘æŒ‰é’®ä¸ºnull
        if (isJsonString(images[i])) {
            // var img = document.createElement("text");
            var imgDiv = document.createElement('div');
            imgDiv.style.width = '384px'; // è®¾ç½®å›ºå®šå®½åº¦
            imgDiv.style.border = 'none'; // å»é™¤è¾¹æ¡†
            imgDiv.style.outline = 'none'; // å»é™¤è½®å»“
            imgDiv.style.resize = 'none'; // æ— æ³•è°ƒæ•´å¤§å°
            imgDiv.style.whiteSpace = 'pre'; // ä¿ç•™ç©ºæ ¼å’Œæ¢è¡Œ
            var text = JSON.stringify(JSON.parse(images[i]), null, 2) + '\n\n'; // æ ¼å¼åŒ–JSONå¹¶æ¢è¡Œ
            imgDiv.textContent = text;
            mediaElement = imgDiv;
        } else if (images[i].toLowerCase().includes(".mp4")) {
            var video = document.createElement("video");
            video.src = images[i];
            video.width = "384";
            video.autoplay = true;
            video.muted = true;
            video.loop = true;
            video.style.display = "block"; // è®©è§†é¢‘å æ®ä¸€è¡Œ

            // åˆ›å»ºå–‡å­æŒ‰é’®
            audioButton = document.createElement("button");
            audioButton.textContent = "ğŸ”‡"; // åˆå§‹ä¸ºé™éŸ³
            audioButton.className = "audio-button";
            audioButton.onclick = (function(v, btn) {
                return function(event) {
                    event.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡åˆ°è§†é¢‘çš„onclick
                    if (v.muted) {
                        v.muted = false;
                        btn.textContent = "ğŸ”Š";
                    } else {
                        v.muted = true;
                        btn.textContent = "ğŸ”‡";
                    }
                };
            })(video, audioButton);

            mediaElement = video;
        } else if (
            images[i].toLowerCase().includes(".jpg") ||
            images[i].toLowerCase().includes(".png") ||
            images[i].toLowerCase().includes(".gif") ||
            images[i].toLowerCase().includes(".jpeg")
        ) {
            var img = document.createElement("img");
            img.src = images[i];
            img.width = "384";
            img.style.display = "block"; // è®©å›¾ç‰‡å æ®ä¸€è¡Œ
            mediaElement = img;
        } else {
            // var img = document.createElement("text");
            var textDiv = document.createElement('div');
            textDiv.style.width = '384px'; // è®¾ç½®å›ºå®šå®½åº¦
            textDiv.style.wordWrap = 'break-word'; // è¶…è¿‡å®½åº¦è‡ªåŠ¨æ¢è¡Œ
            textDiv.style.border = 'none'; // å»é™¤è¾¹æ¡†
            textDiv.style.outline = 'none'; // å»é™¤è½®å»“
            textDiv.style.resize = 'none'; // æ— æ³•è°ƒæ•´å¤§å°
            textDiv.style.whiteSpace = 'pre-wrap'; // ä¿ç•™ç©ºæ ¼å’Œæ¢è¡Œ

            var text = images[i] + '\n'; // æ™®é€šæ–‡æœ¬ç›´æ¥åŠ æ¢è¡Œ
            textDiv.textContent = text;
            mediaElement = textDiv;
        }
        //ç»™åª’ä½“å…ƒç´ æ·»åŠ ä¸€ä¸ªonclickå±æ€§ï¼Œç”¨äºåˆ‡æ¢å¤é€‰æ¡†çš„çŠ¶æ€
        mediaElement.onclick = function() {
          //è·å–å›¾ç‰‡å¯¹åº”çš„å¤é€‰æ¡†å…ƒç´ 
          var checkbox = this.parentNode.querySelector("input[type='checkbox']");
          if (checkbox) {
              //å¦‚æœå¤é€‰æ¡†è¢«é€‰ä¸­ï¼Œå°†å…¶å–æ¶ˆé€‰ä¸­ï¼Œå¹¶å°†å…¶å€¼ä»è¢«é€‰ä¸­çš„å›¾ç‰‡æ•°ç»„ä¸­ç§»é™¤
              if (checkbox.checked) {
                checkbox.checked = false;
                var index = selectedImages.indexOf(checkbox.value);
                if (index > -1) {
                  selectedImages.splice(index, 1);
                }
              } else {
                //å¦‚æœå¤é€‰æ¡†æœªè¢«é€‰ä¸­ï¼Œå°†å…¶é€‰ä¸­ï¼Œå¹¶å°†å…¶å€¼æ·»åŠ åˆ°è¢«é€‰ä¸­çš„å›¾ç‰‡æ•°ç»„ä¸­
                checkbox.checked = true;
                selectedImages.push(checkbox.value);
              }
          }
        };
        //åˆ›å»ºä¸€ä¸ªinputå…ƒç´ ï¼Œè®¾ç½®å…¶typeå±æ€§ä¸ºcheckboxï¼Œç”¨äºè¡¨ç¤ºé€‰ä¸­çŠ¶æ€
        var checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = images[i];
        checkbox.className = "checkbox";
        //ç»™å¤é€‰æ¡†æ·»åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºæ›´æ–°è¢«é€‰ä¸­çš„å›¾ç‰‡æ•°ç»„
        checkbox.onclick = function(event) {
          event.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡åˆ°åª’ä½“å…ƒç´ çš„onclick
          //å¦‚æœå¤é€‰æ¡†è¢«é€‰ä¸­ï¼Œå°†å…¶å€¼æ·»åŠ åˆ°è¢«é€‰ä¸­çš„å›¾ç‰‡æ•°ç»„ä¸­
          if (this.checked) {
            selectedImages.push(this.value);
          } else {
            //å¦‚æœå¤é€‰æ¡†è¢«å–æ¶ˆé€‰ä¸­ï¼Œå°†å…¶å€¼ä»è¢«é€‰ä¸­çš„å›¾ç‰‡æ•°ç»„ä¸­ç§»é™¤
            var index = selectedImages.indexOf(this.value);
            if (index > -1) {
              selectedImages.splice(index, 1);
            }
          }
        };
        //åˆ¤æ–­å½“å‰å›¾ç‰‡é“¾æ¥æ˜¯å¦åœ¨è¢«é€‰ä¸­çš„å›¾ç‰‡æ•°ç»„ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œå°±å°†å¯¹åº”çš„å¤é€‰æ¡†è®¾ç½®ä¸ºé€‰ä¸­çŠ¶æ€
        if (selectedImages.includes(images[i])) {
          checkbox.checked = true;
        }
        //å°†åª’ä½“å…ƒç´ æ·»åŠ åˆ°divå…ƒç´ ä¸­
        div.appendChild(mediaElement);
        // å¦‚æœå­˜åœ¨éŸ³é¢‘æŒ‰é’®ï¼Œåˆ™æ·»åŠ åˆ°div
        if (audioButton) {
            div.appendChild(audioButton);
        }
        //å°†å¤é€‰æ¡†æ·»åŠ åˆ°divå…ƒç´ ä¸­
        div.appendChild(checkbox);
        //å°†divå…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­
        container.appendChild(div);
        if (lineSize != null && (i - startIndex + 1) % lineSize == 0) {
            // æ¢è¡Œ
            var breakTag = document.createElement('br');
            container.appendChild(breakTag);
        }
      }
      //æ›´æ–°å½“å‰é¡µæ•°çš„æ˜¾ç¤º
      document.getElementById("current").innerHTML = page;
    }
    // æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºJSONæ ¼å¼
    function isJsonString(str) {
        try {
            JSON.parse(str);
        } catch (e) {
            return false;
        }
        return true;
    }
    //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ˜¾ç¤ºä¸Šä¸€é¡µçš„å›¾ç‰‡
    function prevPage() {
      //å¦‚æœå½“å‰é¡µæ•°å¤§äº1ï¼Œå°†å½“å‰é¡µæ•°å‡ä¸€ï¼Œå¹¶è°ƒç”¨æ˜¾ç¤ºå›¾ç‰‡çš„å‡½æ•°
      if (currentPage > 1) {
        currentPage--;
        showImages(currentPage, pageSize, lineSize);
      }
    }
    //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ˜¾ç¤ºä¸‹ä¸€é¡µçš„å›¾ç‰‡
    function nextPage() {
      //å¦‚æœå½“å‰é¡µæ•°å°äºæ€»é¡µæ•°ï¼Œå°†å½“å‰é¡µæ•°åŠ ä¸€ï¼Œå¹¶è°ƒç”¨æ˜¾ç¤ºå›¾ç‰‡çš„å‡½æ•°
      if (currentPage < totalPages) {
        currentPage++;
        showImages(currentPage, pageSize, lineSize);
      }
    }
    //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¼å‡ºè¢«é€‰ä¸­çš„å›¾ç‰‡é“¾æ¥
    function exportImages() {
      var button = document.getElementById('exportButton');
      //è·å–è¾“å‡ºæ¡†çš„å…ƒç´ ï¼Œå¹¶æ¸…ç©ºå…¶å†…å®¹
      var output = document.getElementById("output");
      output.value = selectedImages.join("\n");
    }
    <!--button.addEventListener('click', exportImages);-->
    // ç›‘å¬é”®ç›˜äº‹ä»¶
    document.addEventListener('keydown', function(event) {
        if (event.key === 'ArrowLeft') { // å·¦ç®­å¤´é”®
            prevPage();
        } else if (event.key === 'ArrowRight') { // å³ç®­å¤´é”®
            nextPage();
        }
    });
    document.addEventListener('DOMContentLoaded', function() {
      // æ›´æ–°æŒ‰é’®äº‹ä»¶ï¼Œå¢åŠ è®¾ç½®æ¯é¡µå›¾ç‰‡æ•°é‡å’Œè·³è½¬åˆ°æŒ‡å®šé¡µé¢çš„åŠŸèƒ½
      document.getElementById('pageSizeInput').addEventListener('change', function() {
        setPageSize(this.value);
      });
      document.getElementById('lineSizeInput').addEventListener('change', function() {
        setLineSize(this.value);
      });
      document.getElementById('goToPageInput').addEventListener('change', function() {
        const page = parseInt(this.value);
        if (!isNaN(page)) {
          goToPage(page);
          this.value = '';
        }
      });
    });
    function filterImages(regexStr) {
        if (!regexStr) return;
        try {
            var regex = new RegExp(regexStr, 'i'); // åˆ›å»ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼
            images = images.filter(url => regex.test(url)); // ç­›é€‰å‡ºåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å›¾ç‰‡
            currentPage = 1; // é‡ç½®å½“å‰é¡µæ•°
            totalPages = Math.ceil(images.length / pageSize); // é‡æ–°è®¡ç®—æ€»é¡µæ•°
              //æ›´æ–°æ€»é¡µæ•°çš„æ˜¾ç¤º
            document.getElementById("total").innerHTML = totalPages;
            showImages(currentPage, pageSize, lineSize); // æ˜¾ç¤ºç­›é€‰åçš„ç¬¬ä¸€é¡µé¢å›¾ç‰‡
        } catch (error) {
            alert("æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚");
        }
    }
    </script>
</head>
<body>
<h1>å›¾ç‰‡å±•ç¤ºå’Œé€‰æ‹©</h1>
<p>è¯·åœ¨ä¸‹é¢çš„æ–‡æœ¬æ¡†ä¸­è¾“å…¥å¤šè¡Œå›¾ç‰‡é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªé“¾æ¥</p>
<textarea id="input" rows="10" cols="100"></textarea><br>
<input type="text" id="filterInput" placeholder="æ­£åˆ™è¡¨è¾¾å¼">
<button onclick="filterImages(document.getElementById('filterInput').value)">ç­›é€‰å›¾ç‰‡</button>
<div></div>
<button onclick="loadImages(newPageSize)">åŠ è½½å›¾ç‰‡</button>
<button onclick="prevPage()">ä¸Šä¸€é¡µ</button>
<button onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
<button id="exportButton" onclick="exportImages()">å¯¼å‡ºé€‰ä¸­çš„å›¾ç‰‡é“¾æ¥</button>
<br>
<input type="number" id="pageSizeInput" placeholder="æ¯é¡µæ•°é‡" min="1">
<input type="number" id="lineSizeInput" placeholder="æ¯è¡Œæ•°é‡" min="1">
<input type="text" id="goToPageInput" placeholder="è·³è½¬åˆ°é¡µç " onfocus="this.placeholder = ''" onblur="this.placeholder = 'è·³è½¬åˆ°é¡µç '">
<div></div>
<p>å½“å‰ç¬¬<span id="current">0</span>é¡µï¼Œå…±<span id="total">0</span>é¡µ</p>
<div id="container"></div>
<p>è¾“å‡ºæ¡†ï¼š</p>
<textarea id="output" rows="10" cols="100" readonly></textarea>
</body>
</html>
