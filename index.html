<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¿å­˜çš„å¤šåª’ä½“å±•ç¤ºä¸é€‰æ‹©å·¥å…·</title>
    <style>
        /* å¤åˆ¶åŸæœ‰çš„CSSæ ·å¼ */
        /* CSSå˜é‡ç”¨äºä¸»é¢˜åˆ‡æ¢ */
        :root {
            /* æµ…è‰²ä¸»é¢˜å˜é‡ */
            --background-color: #f4f4f4;
            --toolbar-background: #fff;
            --text-color: #333;
            --button-background: #007BFF;
            --button-hover: #0056b3;
            --button-disabled: #cccccc;
            --media-background: #fff;
            --checkbox-background: rgba(255, 255, 255, 0.8);
            --feedback-color: green;
            --modal-background: #fff;
            --modal-text-color: #333;
            --search-modal-background: #fff;
            --search-modal-text-color: #333;
        }
        /* æ·±è‰²ä¸»é¢˜å˜é‡ */
        .dark-theme {
            --background-color: #2c2c2c;
            --toolbar-background: #333;
            --text-color: #f4f4f4;
            --button-background: #1a73e8;
            --button-hover: #135ab4;
            --button-disabled: #555555;
            --media-background: #444;
            --checkbox-background: rgba(50, 50, 50, 0.8);
            --feedback-color: #4caf50;
            --modal-background: #555;
            --modal-text-color: #f4f4f4;
            --search-modal-background: #555;
            --search-modal-text-color: #f4f4f4;
        }
        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
        }
        /* é¡¶éƒ¨å·¥å…·æ æ ·å¼ */
        .toolbar {
            background-color: var(--toolbar-background);
            padding: 10px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: background-color 0.3s;
        }
        .toolbar .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }
        .toolbar label {
            margin-right: 5px;
            font-weight: bold;
        }
        .toolbar input[type="text"],
        .toolbar input[type="number"],
        .toolbar textarea {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
            max-width: 100%;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }
        /* æµ…è‰²å’Œæ·±è‰²ä¸»é¢˜è¾“å…¥æ¡†æ ·å¼ */
        body.light-theme input[type="text"],
        body.light-theme input[type="number"],
        body.light-theme textarea {
            background-color: #fff;
            color: #333;
        }
        body.dark-theme input[type="text"],
        body.dark-theme input[type="number"],
        body.dark-theme textarea {
            background-color: #555;
            color: #f4f4f4;
            border: 1px solid #666;
        }
        .toolbar textarea {
            resize: vertical;
            height: 60px;
        }
        .toolbar button {
            padding: 7px 12px;
            border: none;
            border-radius: 4px;
            background-color: var(--button-background);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        .toolbar button:hover {
            background-color: var(--button-hover);
        }
        .toolbar button:disabled {
            background-color: var(--button-disabled);
            cursor: not-allowed;
        }
        /* å†…å®¹å®¹å™¨æ ·å¼ */
        #container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* é»˜è®¤å“åº”å¼ */
            gap: 20px;
            padding: 20px;
            justify-items: stretch; /* ä¿®æ”¹æ­¤è¡Œä»¥ç¡®ä¿æ¯ä¸ªç½‘æ ¼é¡¹æ‹‰ä¼¸ä»¥å¡«æ»¡åˆ—å®½åº¦ */
            justify-items: center; /* ä¿æŒç½‘æ ¼é¡¹å±…ä¸­å¯¹é½ */
            justify-content: center; /* å±…ä¸­æ•´ä¸ªç½‘æ ¼ */
        }
        .media-item {
            position: relative;
            background-color: var(--media-background);
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
            display: flex;
            flex-direction: column;
            height: 100%; /* ç¡®ä¿é«˜åº¦ä¸€è‡´ */
            width: 100%; /* ä¿®æ”¹æ­¤è¡Œä»¥ä½¿å®½åº¦ç­‰äºçˆ¶å®¹å™¨åˆ†é…çš„å®½åº¦ */
            max-width: 500px; /* è®¾ç½®åª’ä½“é¡¹çš„æœ€å¤§å®½åº¦ */
            transition: transform 0.3s ease, width 0.3s ease, box-shadow 0.3s ease;
            position: relative; /* ç¡®ä¿æ”¾å¤§æ—¶å¯å åŠ  */
            z-index: 1; /* é»˜è®¤å±‚çº§ */
        }
        .media-item.enlarged {
            transform: scale(1.2); /* å¹³æ»‘æ”¾å¤§ */
            width: 500px !important; /* å¼ºåˆ¶å®½åº¦ */
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); /* åŠ å¼ºé˜´å½±æ•ˆæœ */
            z-index: 2000; /* æå‡å±‚çº§ï¼Œç¡®ä¿åœ¨æœ€å‰é¢ */
        }
        /* ç¡®ä¿æ”¾å¤§æ—¶å¤é€‰æ¡†å’Œé™éŸ³æŒ‰é’®ä¿æŒå¯è§ */
        .media-item.enlarged .checkbox-container,
        .media-item.enlarged .audio-button {
            opacity: 1;
            pointer-events: auto;
        }
        /* éšè—éæ”¾å¤§çŠ¶æ€ä¸‹å¤é€‰æ¡†å’Œé™éŸ³æŒ‰é’® */
        .checkbox-container,
        .audio-button {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .media-item:hover .checkbox-container,
        .media-item:hover .audio-button {
            opacity: 1;
            pointer-events: auto;
        }
        /* åª’ä½“å…ƒç´ æ ·å¼ */
        .media-content {
            width: 100%;
            height: auto;
            display: block;
            flex-grow: 1;
            object-fit: contain; /* ç¡®ä¿åª’ä½“å†…å®¹å¡«æ»¡å®¹å™¨ä¸”ä¿æŒæ¯”ä¾‹ */
        }
        .text-content {
            padding: 10px;
            white-space: pre-wrap;
            word-break: break-word;
            flex-grow: 1;
            font-family: Consolas, "Courier New", monospace;
            /* background-color: #f6f8fa; */
            border-radius: 4px;
            overflow-x: auto;
        }
        /* JSONè¯­æ³•é«˜äº®æ ·å¼ */
        .json-key {
            color: #c92c2c;
        }
        .json-string {
            color: #22863a;
        }
        .json-number {
            color: #005cc5;
        }
        .json-boolean {
            color: #d73a49;
        }
        .json-null {
            color: #6a737d;
        }
        /* å–‡å­æŒ‰é’®æ ·å¼ */
        .audio-button {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 5px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s, background-color 0.3s;
            pointer-events: auto; /* ç¡®ä¿æŒ‰é’®å¯ç‚¹å‡» */
            width: 30px;
            height: 30px;
            font-size: 16px;
        }
        .video-container:hover .audio-button {
            opacity: 1; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæŒ‰é’® */
        }
        /* å¤é€‰æ¡†å®¹å™¨æ ·å¼ */
        .checkbox-container {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--checkbox-background);
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 2px;
            opacity: 0; /* é»˜è®¤éšè— */
            transition: opacity 0.3s;
            pointer-events: none; /* é»˜è®¤ä¸å“åº”äº‹ä»¶ */
        }
        .media-item:hover .checkbox-container {
            opacity: 1; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºå¤é€‰æ¡† */
            pointer-events: auto; /* å…è®¸å“åº”äº‹ä»¶ */
        }
        .media-item.selected .checkbox-container {
            opacity: 1;
            pointer-events: auto;
        }
        .checkbox-container input[type="checkbox"] {
            transform: scale(1.2);
            cursor: pointer;
        }
        /* åé¦ˆæ¶ˆæ¯æ ·å¼ */
        #feedback {
            position: fixed;
            top: 20px; /* è·ç¦»é¡¶éƒ¨20px */
            left: 50%; /* æ°´å¹³å±…ä¸­ */
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            background-color: rgba(0, 123, 255, 0.9); /* é»˜è®¤èƒŒæ™¯é¢œè‰²ï¼ˆè“è‰²ï¼‰ */
            color: white; /* æ–‡å­—é¢œè‰²ä¸ºç™½è‰² */
            padding: 10px 20px; /* å†…è¾¹è· */
            border-radius: 5px; /* è¾¹è§’åœ†æ¶¦ */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3); /* é˜´å½±æ•ˆæœ */
            z-index: 10000; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
            opacity: 0; /* é»˜è®¤éšè— */
            transition: opacity 0.5s ease, transform 0.5s ease; /* æ¸å˜æ•ˆæœ */
            pointer-events: none; /* å…è®¸ç‚¹å‡»ç©¿é€ */
        }
        /* æ˜¾ç¤ºåé¦ˆæ¶ˆæ¯ */
        #feedback.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0); /* æ˜¾ç¤ºæ—¶è°ƒæ•´ä½ç½® */
        }
        /* é”™è¯¯çŠ¶æ€çš„åé¦ˆæ¶ˆæ¯ */
        #feedback.error {
            background-color: rgba(220, 53, 69, 0.9); /* çº¢è‰²èƒŒæ™¯è¡¨ç¤ºé”™è¯¯ */
        }
        /* å¯¼å‡ºåŒºåŸŸæ ·å¼ */
        #output {
            width: calc(100% - 40px);
            margin: 0 20px 20px 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
            box-sizing: border-box;
            height: 100px;
        }
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 800px) {
            .toolbar .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .toolbar input[type="text"],
            .toolbar input[type="number"],
            .toolbar textarea {
                width: 100%;
            }
            #output {
                width: calc(100% - 40px);
            }
        }
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .theme-toggle {
            margin-left: 10px;
            background-color: transparent;
            color: var(--text-color);
            border: none;
            cursor: pointer;
            font-size: 18px;
            transition: color 0.3s;
        }
        .theme-toggle:hover {
            color: var(--button-hover);
        }
        /* å¸®åŠ©æŒ‰é’®æ ·å¼ */
        .help-button {
            margin-left: 10px;
            background-color: transparent;
            color: var(--text-color);
            border: none;
            cursor: pointer;
            font-size: 18px;
            transition: color 0.3s;
        }
        .help-button:hover {
            color: var(--button-hover);
        }
        /* ä¿å­˜æŒ‰é’®æ ·å¼ */
        .save-button {
            margin-left: 10px;
            background-color: #28a745; /* ç»¿è‰²èƒŒæ™¯ */
            color: white;
        }
        .save-button:hover {
            background-color: #218838;
        }
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        }
        .modal-content {
            background-color: var(--modal-background);
            margin: 10% auto; /* 10% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            border-radius: 8px;
            color: var(--modal-text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }
        /* æ‰¹é‡æ“ä½œæŒ‰é’®æ ·å¼ */
        .batch-buttons {
            margin: 10px 0;
            text-align: center;
        }
        .batch-buttons button {
            margin: 0 5px;
        }
        /* Commandå›¾æ ‡æ ·å¼ */
        .command-icon {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-color);
            transition: color 0.3s;
            margin-left: 10px;
        }
        .command-icon:hover {
            color: var(--button-hover) !important;
        }

        .command-icon.active {
            color: var(--button-hover) !important;
        }

        /* æ”¾å¤§é•œæœç´¢å›¾æ ‡æ ·å¼ */
        .search-icon {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-color);
            transition: color 0.3s;
            margin-left: 10px;
        }
        .search-icon:hover {
            color: var(--button-hover);
        }
        /* æœç´¢æ¨¡æ€æ¡†æ ·å¼ */
        #searchModal .modal-content {
            background-color: var(--search-modal-background);
            color: var(--search-modal-text-color);
        }
        /* æœç´¢æ¨¡å¼åˆ‡æ¢æ ·å¼ */
        .search-mode {
            margin-top: 10px;
        }
        .search-mode label {
            margin-right: 10px;
        }
        /* æµ®åŠ¨åª’ä½“å¼¹å‡ºæ¡†æ ·å¼ */
        .popup {
            position: absolute;
            width: 500px;
            background-color: rgba(255, 255, 255, 0.8); /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); /* æ›´å¼ºçš„é˜´å½±æ•ˆæœ */
            z-index: 3000;
            padding: 20px;
            color: #fff; /* ç™½è‰²æ–‡å­— */
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            pointer-events: none; /* é»˜è®¤ä¸å¯ç‚¹å‡» */
        }
        /* å¸¸è§„ç®­å¤´æ ·å¼ */
        .popup::after {
            content: "";
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            z-index: -1;
        }
        /* ç®­å¤´æŒ‡å‘å³ä¾§ */
        .popup.arrow-left::after {
            border-width: 10px 10px 10px 0;
            border-color: transparent #fff transparent transparent;
            left: -10px;
            top: 20px;
        }
        /* ç®­å¤´æŒ‡å‘å·¦ä¾§ */
        .popup.arrow-right::after {
            border-width: 10px 0 10px 10px;
            border-color: transparent transparent transparent #fff;
            right: -10px;
            top: 20px;
        }
        /* æ˜¾ç¤ºå¼¹å‡ºæ¡† */
        .popup.show {
            opacity: 1;
            pointer-events: auto; /* å¯ç‚¹å‡» */
        }
        /* å¼ºè°ƒæ”¾å¤§æ¡†å†…å®¹ */
        .popup .popup-media-container {
            max-height: 80vh;
            overflow: auto;
        }
        .popup-media-container img,
        .popup-media-container video,
        .popup-media-container audio {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .popup-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        /* å¼¹å‡ºæ¡†å†…çš„å¤é€‰æ¡†å’Œé™éŸ³æŒ‰é’®æ ·å¼ */
        #popupCheckbox {
            transform: scale(1.2);
            cursor: pointer;
        }
        #popupMuteButton {
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
        }

        .zoom-box {
            position: fixed; /* ç¡®ä¿ç›¸å¯¹äºè§†å£å®šä½ */
            width: 400px;
            height: 400px;
            border: 1px solid #333; /* å¢åŠ è¾¹æ¡†åšåº¦ */
            overflow: hidden;
            display: none;
            z-index: 1000; /* ç¡®ä¿åœ¨ä¸Šå±‚ */
            background-color: rgba(255, 255, 255, 0.9); /* è°ƒæ•´èƒŒæ™¯é¢œè‰² */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* æ·»åŠ é˜´å½±æ•ˆæœ */
            /* border-radius: 8px;  å¢åŠ åœ†è§’ */
        }

        .magnifier-box {
            position: absolute;
            width: 60px; /* ä»40pxå¢åŠ åˆ°60px */
            height: 60px; /* ä»40pxå¢åŠ åˆ°60px */
            border: 1px solid white; /* å¢åŠ è¾¹æ¡†åšåº¦ */
            background-color: rgba(255, 255, 255, 0.3);
            pointer-events: none;
            display: none;
            z-index: 1001; /* ç¡®ä¿åœ¨ zoom-box ä¹‹ä¸Š */
            /* border-radius: 6px;  å¢åŠ åœ†è§’ */
        }

    </style>
</head>
<body class="light-theme">
    <h1>å¤šåª’ä½“å±•ç¤ºä¸é€‰æ‹©å·¥å…·</h1>
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="toolbar">
        <div class="controls">
            <div>
                <label for="input">åª’ä½“é“¾æ¥ï¼š</label><br>
                <textarea id="input" placeholder="æ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œä¾‹å¦‚ï¼š
https://example.com/image1.jpg
https://example.com/video1.mp4
https://example.com/audio1.mp3
https://example.com/data1.json"></textarea>
            </div>
            <div>
                <button onclick="loadImages()">åŠ è½½åª’ä½“</button>
                <button onclick="prevPage()" id="prevButton" disabled>ä¸Šä¸€é¡µ</button>
                <button onclick="nextPage()" id="nextButton" disabled>ä¸‹ä¸€é¡µ</button>
                <button id="exportButton" onclick="exportImages()" disabled>å¯¼å‡ºé€‰ä¸­é“¾æ¥</button>
                <!-- æ–°å¢çš„ä¿å­˜æŒ‰é’® -->
                <button class="save-button" onclick="savePage()">å¯¼å‡ºDemoé¡µé¢</button>
            </div>
            <div>
                <label for="pageSizeInput">æ¯é¡µè¡Œæ•°ï¼š</label><br>
                <input type="number" id="pageSizeInput" placeholder="ä¾‹å¦‚ï¼š2" min="1">
            </div>
            <div>
                <label for="lineSizeInput">æ¯è¡Œæ•°é‡ï¼š</label><br>
                <input type="number" id="lineSizeInput" placeholder="ä¾‹å¦‚ï¼š4" min="1">
            </div>
            <div>
                <label for="goToPageInput">è·³è½¬åˆ°é¡µç ï¼š</label><br>
                <input type="text" id="goToPageInput" placeholder="ä¾‹å¦‚ï¼š1">
            </div>

            <!-- æ‰©å±•åŠŸèƒ½æŒ‰é’® -->
            <button class="command-icon" onclick="openCommandHelp()" title="æ”¾å¤§" style="color: white;">âŒ˜</button>
            <button class="search-icon" onclick="openSearch()" title="æœç´¢åª’ä½“">ğŸ”</button>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
            <button class="help-button" onclick="openHelp()" title="å¸®åŠ©">â“</button>
        </div>
    </div>
    <!-- æ‰¹é‡æ“ä½œæŒ‰é’® -->
    <div class="batch-buttons">
        <button onclick="selectAll()">å…¨é€‰æœ¬é¡µ</button>
        <button onclick="deselectAll()">å–æ¶ˆå…¨é€‰</button>
    </div>
    <!-- å½“å‰é¡µæ•°æ˜¾ç¤º -->
    <p style="text-align:center;">å½“å‰ç¬¬<span id="current">0</span>é¡µï¼Œå…±<span id="total">0</span>é¡µ</p>
    <!-- åª’ä½“å†…å®¹å®¹å™¨ -->
    <div id="container"></div>
    <!-- å¯¼å‡ºé“¾æ¥åŒºåŸŸ -->
    <p style="text-align:center;">å¯¼å‡ºçš„é“¾æ¥ï¼š</p>
    <textarea id="output" readonly></textarea>
    <!-- åé¦ˆæ¶ˆæ¯ -->
    <div id="feedback"></div>
    <!-- æœç´¢æ¨¡æ€æ¡† -->
    <div id="searchModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeSearch()">&times;</span>
            <h2>æœç´¢åª’ä½“</h2>
            <input type="text" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯æˆ–æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢" style="width: 100%; padding: 8px; box-sizing: border-box;">
            <div class="search-mode">
                <label><input type="radio" name="searchMode" value="keyword" checked> å…³é”®è¯æœç´¢</label>
                <label><input type="radio" name="searchMode" value="regex"> æ­£åˆ™è¡¨è¾¾å¼æœç´¢</label>
            </div>
            <button onclick="performSearch()" style="margin-top: 10px;">æœç´¢</button>
            <button onclick="clearSearch()" style="margin-top: 10px; margin-left: 10px;">æ¸…ç©ºæœç´¢</button>
        </div>
    </div>
    <!-- âŒ˜å¸®åŠ©æ¨¡æ€æ¡† -->
    <div id="commandModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeCommandHelp()">&times;</span>
            <p>æŒ‰ä¸‹âŒ˜é”®å¼€å§‹æ”¾å¤§ã€‚</p>
        </div>
    </div>
    <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeHelp()">&times;</span>
            <h2>ä½¿ç”¨æŒ‡å—</h2>
            <p>æ¬¢è¿ä½¿ç”¨å¤šåª’ä½“å±•ç¤ºä¸é€‰æ‹©å·¥å…·ã€‚ä»¥ä¸‹æ˜¯å„åŠŸèƒ½çš„ä½¿ç”¨è¯´æ˜ï¼š</p>
            <ul>
                <li><strong>åŠ è½½åª’ä½“ï¼š</strong>å°†åª’ä½“é“¾æ¥ç²˜è´´åˆ°â€œåª’ä½“é“¾æ¥â€æ–‡æœ¬æ¡†ä¸­ï¼Œæ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œç„¶åç‚¹å‡»â€œåŠ è½½åª’ä½“â€æŒ‰é’®ã€‚</li>
                <li><strong>æŒ‰è¡Œç­›é€‰ï¼š</strong>ç‚¹å‡»é¡¶éƒ¨å·¥å…·æ ä¸­çš„ğŸ”æ”¾å¤§é•œå›¾æ ‡ï¼Œæ‰“å¼€æœç´¢æ¨¡æ€æ¡†ã€‚åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶é€‰æ‹©æœç´¢æ¨¡å¼ï¼ˆå…³é”®è¯æœç´¢æˆ–æ­£åˆ™è¡¨è¾¾å¼æœç´¢ï¼‰ï¼Œç„¶åç‚¹å‡»â€œæœç´¢â€æŒ‰é’®ã€‚</li>
                <li><strong>æ¸…ç©ºæœç´¢ï¼š</strong>åœ¨æœç´¢æ¨¡æ€æ¡†ä¸­ï¼Œç‚¹å‡»â€œæ¸…ç©ºæœç´¢â€æŒ‰é’®ï¼Œå°†æ¢å¤æ˜¾ç¤ºæ‰€æœ‰åª’ä½“é¡¹ã€‚</li>
                <li><strong>é€‰æ‹©åª’ä½“ï¼š</strong>å°†é¼ æ ‡æ‚¬åœåœ¨åª’ä½“é¡¹ä¸Šï¼Œå³ä¸Šè§’çš„å¤é€‰æ¡†å°†å‡ºç°ã€‚ç‚¹å‡»å¤é€‰æ¡†æˆ–ç›´æ¥ç‚¹å‡»åª’ä½“é¡¹è¿›è¡Œé€‰æ‹©æˆ–å–æ¶ˆé€‰æ‹©ã€‚</li>
                <li><strong>æ‰¹é‡æ“ä½œï¼š</strong>ä½¿ç”¨â€œå…¨é€‰æœ¬é¡µâ€æŒ‰é’®é€‰æ‹©æ‰€æœ‰å½“å‰é¡µçš„åª’ä½“ï¼Œä½¿ç”¨â€œå–æ¶ˆå…¨é€‰â€æŒ‰é’®å–æ¶ˆé€‰æ‹©ã€‚</li>
                <li><strong>å¯¼å‡ºé“¾æ¥ï¼š</strong>é€‰æ‹©å¤šä¸ªåª’ä½“é¡¹åï¼Œç‚¹å‡»â€œå¯¼å‡ºé€‰ä¸­é“¾æ¥â€æŒ‰é’®ï¼Œé€‰ä¸­çš„é“¾æ¥å°†è‡ªåŠ¨å¤åˆ¶åˆ°ä¸‹é¢çš„â€œå¯¼å‡ºçš„é“¾æ¥â€åŒºåŸŸï¼Œæ‚¨å¯ä»¥ç›´æ¥ç²˜è´´ä½¿ç”¨ã€‚</li>
                <li><strong>åˆ†é¡µæ§åˆ¶ï¼š</strong>ä½¿ç”¨â€œä¸Šä¸€é¡µâ€å’Œâ€œä¸‹ä¸€é¡µâ€æŒ‰é’®è¿›è¡Œåˆ†é¡µå¯¼èˆªï¼Œæˆ–åœ¨â€œè·³è½¬åˆ°é¡µç â€è¾“å…¥æ¡†ä¸­è¾“å…¥å…·ä½“é¡µç å¹¶æŒ‰å›è½¦é”®è¿›è¡Œè·³è½¬ã€‚</li>
                <li><strong>è°ƒæ•´æ˜¾ç¤ºæ•°é‡ï¼š</strong>åœ¨â€œæ¯é¡µè¡Œæ•°â€è¾“å…¥æ¡†ä¸­è®¾ç½®æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°é‡ï¼Œåœ¨â€œæ¯è¡Œæ•°é‡â€è¾“å…¥æ¡†ä¸­è®¾ç½®æ¯è¡Œæ˜¾ç¤ºçš„åª’ä½“é¡¹æ•°é‡ã€‚</li>
                <li><strong>ä¸»é¢˜åˆ‡æ¢ï¼š</strong>ç‚¹å‡»é¡¶éƒ¨å·¥å…·æ ä¸­çš„ğŸŒ“æŒ‰é’®åˆ‡æ¢æµ…è‰²å’Œæ·±è‰²ä¸»é¢˜ï¼Œé€‚åº”ä¸åŒçš„è§†è§‰éœ€æ±‚ã€‚ç³»ç»Ÿå°†æ ¹æ®æ—¶é—´è‡ªåŠ¨è°ƒæ•´ä¸»é¢˜ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ã€‚</li>
                <li><strong>éŸ³é¢‘æ§åˆ¶ï¼š</strong>å¯¹äºè§†é¢‘å’ŒéŸ³é¢‘åª’ä½“ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨åª’ä½“é¡¹ä¸Šï¼Œåº•éƒ¨çš„å–‡å­æŒ‰é’®ï¼ˆğŸ”‡/ğŸ”Šï¼‰å°†å‡ºç°ã€‚ç‚¹å‡»æŒ‰é’®å¯ä»¥åˆ‡æ¢åª’ä½“çš„é™éŸ³çŠ¶æ€ã€‚</li>
                <li><strong>é”®ç›˜å¿«æ·é”®ï¼š</strong>åœ¨éè¾“å…¥æ¡†å’Œæ–‡æœ¬åŒºåŸŸæ—¶ï¼ŒæŒ‰å·¦å³ç®­å¤´é”®å¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€é¡µæˆ–ä¸‹ä¸€é¡µã€‚</li>
            </ul>
            <p>å¸Œæœ›æ‚¨ä½¿ç”¨æ„‰å¿«ï¼è‹¥æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆã€‚</p>
        </div>
    </div>
    <!-- æµ®åŠ¨åª’ä½“å¼¹å‡ºæ¡† -->
    <div id="popup" class="popup">
        <div class="popup-media-container"></div>
    </div>
    <script>
        (function() {
            // å®šä¹‰å˜é‡
            let originalImages = []; // åŸå§‹åª’ä½“é“¾æ¥
            let images = []; // å½“å‰å±•ç¤ºçš„è®°å½•
            let currentPage = 1;
            let pageSize = 2; // æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°
            let lineSize = 4; // æ¯è¡Œæ˜¾ç¤ºçš„åª’ä½“é¡¹æ•°
            let totalPages = 0;
            const selectedIndices = new Set();
            // DOMå…ƒç´ ç¼“å­˜
            const inputTextArea = document.getElementById("input");
            const container = document.getElementById("container");
            const currentSpan = document.getElementById("current");
            const totalSpan = document.getElementById("total");
            const prevButton = document.getElementById("prevButton");
            const nextButton = document.getElementById("nextButton");
            const exportButton = document.getElementById("exportButton");
            const outputTextArea = document.getElementById("output");
            const feedbackDiv = document.getElementById("feedback");
            const helpModal = document.getElementById("helpModal");
            const commandModal = document.getElementById("commandModal");
            const searchModal = document.getElementById("searchModal");
            const searchInput = document.getElementById("searchInput");
            const searchModeRadios = document.getElementsByName("searchMode");
            // è¯­æ³•é«˜äº®å‡½æ•°
            function syntaxHighlight(json) {
                if (typeof json !== 'string') {
                    json = JSON.stringify(json, undefined, 2);
                }
                json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(?=\s*:))|("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*")|(\b(true|false|null)\b)|(\b\d+\b)/g, function (match) {
                    let cls = 'json-number';
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = 'json-key';
                        } else {
                            cls = 'json-string';
                        }
                    } else if (/true|false/.test(match)) {
                        cls = 'json-boolean';
                    } else if (/null/.test(match)) {
                        cls = 'json-null';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
                });
            }
            // åŠ è½½åª’ä½“å‡½æ•°
            window.loadImages = function() {
                const exportLen = exportImages(); // è‡ªåŠ¨å¯¼å‡ºå½“å‰é€‰æ‹©çš„é“¾æ¥
                const text = inputTextArea.value.replace(/\t/g, "\n");
                const lines = text.split("\n").map(line => line.trim()).filter(line => line !== "");
                originalImages = lines; // ä¿å­˜åŸå§‹åª’ä½“é“¾æ¥
                selectedIndices.size = 0; // æ¸…ç©ºå·²é€‰ä¸­çš„æ•°ç»„
                groupImages(); // åˆ†ç»„åª’ä½“é“¾æ¥
                currentPage = 1;
                totalPages = Math.ceil(images.length / pageSize);
                updatePagination();
                renderImages();
                if (!exportLen) {
                showFeedback(`åŠ è½½äº† ${originalImages.length} ä¸ªåª’ä½“é“¾æ¥ã€‚`);
                } else{
                    showFeedback(`åŠ è½½äº† ${originalImages.length} ä¸ªåª’ä½“é“¾æ¥ã€‚\n ${exportLen} ä¸ªå†…å®¹å·²å¤‡ä»½`);
                }
            };
            // æŒ‰è¡Œåˆ—åˆ†ç»„åª’ä½“é“¾æ¥
            function groupImages() {
                images = [];
                for (let i = 0; i < originalImages.length; i += lineSize) {
                    const group = originalImages.slice(i, i + lineSize);
                    images.push(group);
                }
            }
            // æ¸²æŸ“åª’ä½“
            function renderImages() {
                container.innerHTML = "";
                if (images.length === 0) {
                    container.innerHTML = "<p style='text-align:center;'>æ²¡æœ‰è¦æ˜¾ç¤ºçš„åª’ä½“ã€‚</p>";
                    return;
                }
                const startIndex = (currentPage - 1) * pageSize;
                const endIndex = Math.min(currentPage * pageSize, images.length);
                const currentRecords = images.slice(startIndex, endIndex);
                currentRecords.forEach((record, recordIndex) => {
                   record.forEach((url, index) => {
                       const globalIndex = startIndex * lineSize + recordIndex * lineSize + index;
                       const mediaItem = createMediaItem(url, globalIndex);
                       container.appendChild(mediaItem);
                   });
                });
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                prevButton.disabled = currentPage === 1;
                nextButton.disabled = currentPage === totalPages;
                updateExportButton();
            }
            // åˆ›å»ºæ–‡æœ¬å†…å®¹ï¼ˆæ”¯æŒJSONè¯­æ³•é«˜äº®ï¼‰
            function createTextContent(text) {
                const textDiv = document.createElement("div");
                textDiv.className = "text-content";
                if (isJsonString(text)) {
                    try {
                        const jsonObj = JSON.parse(text);
                        textDiv.innerHTML = syntaxHighlight(jsonObj);
                    } catch (e) {
                        textDiv.textContent = text; // å¦‚æœJSONè§£æå¤±è´¥ï¼Œåˆ™æ˜¾ç¤ºåŸæ–‡æœ¬
                    }
                } else {
                    textDiv.textContent = text;
                }
                textDiv.setAttribute("aria-label", "æ–‡æœ¬å†…å®¹");
                return textDiv;
            }
            // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
            function createImage(src) {
                const img = document.createElement("img");
                img.src = src;
                img.className = "media-content";
                img.alt = "å›¾ç‰‡å†…å®¹";
                return img;
            }
            // åˆ›å»ºè§†é¢‘å…ƒç´ 
            function createVideo(src) {
                const video = document.createElement("video");
                video.src = src;
                video.autoplay = true;
                video.muted = true;
                video.loop = true;
                video.className = "media-content";
                video.setAttribute("aria-label", "Video content");
                return video;
            }
            // åˆ›å»ºéŸ³é¢‘å…ƒç´ 
            function createAudio(src) {
                const audio = document.createElement("audio");
                audio.src = src;
                audio.controls = true;
                audio.className = "media-content";
                audio.setAttribute("aria-label", "éŸ³é¢‘å†…å®¹");
                return audio;
            }
            // åˆ›å»ºéŸ³é¢‘æŒ‰é’®
            function createAudioButton(video) {
                const button = document.createElement("button");
                button.className = "audio-button";
                button.innerHTML = "ğŸ”‡";
                button.setAttribute("aria-label", "åˆ‡æ¢å£°éŸ³");
                button.addEventListener("click", (e) => {
                    e.stopPropagation();
                    video.muted = !video.muted;
                    button.innerHTML = video.muted ? "ğŸ”‡" : "ğŸ”Š";
                });
                return button;
            }
            // è®¾ç½®æ¯é¡µè¡Œæ•°
            const pageSizeInput = document.getElementById("pageSizeInput");
            pageSizeInput.value = pageSize;
            pageSizeInput.addEventListener("change", (e) => {
                const val = parseInt(e.target.value);
                if (!isNaN(val) && val > 0) {
                    pageSize = val;
                    totalPages = Math.ceil(images.length / pageSize);
                    currentPage = Math.min(currentPage, totalPages);
                    updatePagination();
                    renderImages();
                    showFeedback(`æ¯é¡µæ˜¾ç¤ºæ•°é‡è®¾ç½®ä¸º ${pageSize}ã€‚`);
                } else {
                    showFeedback("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¯é¡µè¡Œæ•°ï¼ˆå¤§äº0ï¼‰ã€‚", true);
                }
            });
            // è®¾ç½®æ¯è¡Œæ•°é‡
            const lineSizeInput = document.getElementById("lineSizeInput");
            lineSizeInput.value = lineSize;
            lineSizeInput.addEventListener("change", (e) => {
                const val = parseInt(e.target.value);
                if (!isNaN(val) && val > 0) {
                    const currentIndex = (currentPage - 1) * pageSize; // è®°ä½å½“å‰è®°å½•çš„èµ·å§‹ä½ç½®
                    lineSize = val;
                    groupImages(); // é‡æ–°åˆ†ç»„åª’ä½“é“¾æ¥
                    totalPages = Math.ceil(images.length / pageSize);
                    currentPage = Math.floor(currentIndex / pageSize) + 1; // æ ¹æ®æ–°çš„pageSizeè®¡ç®—å½“å‰é¡µ
                    updatePagination();
                    // è®¾ç½® grid-template-columns æ ¹æ® lineSize
                    container.style.gridTemplateColumns = `repeat(${lineSize}, 1fr)`;
                    renderImages();
                    showFeedback(`æ¯è¡Œæ˜¾ç¤ºæ•°é‡è®¾ç½®ä¸º ${lineSize}ã€‚`);
                } else {
                    showFeedback("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¯è¡Œæ•°é‡ï¼ˆå¤§äº0ï¼‰ã€‚", true);
                }
            });

            // æ·»åŠ èŠ‚æµåŠŸèƒ½
            function throttle(func, limit) {
                let lastFunc;
                let lastRan;
                return function(...args) {
                    const context = this;
                    if (!lastRan) {
                        func.apply(context, args);
                        lastRan = Date.now();
                    } else {
                        clearTimeout(lastFunc);
                        lastFunc = setTimeout(function() {
                            if ((Date.now() - lastRan) >= limit) {
                                func.apply(context, args);
                                lastRan = Date.now();
                            }
                        }, limit - (Date.now() - lastRan));
                    }
                }
            }
            // è·³è½¬åˆ°æŒ‡å®šé¡µç 
            const goToPageInput = document.getElementById("goToPageInput");
            goToPageInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    const page = parseInt(e.target.value);
                    if (!isNaN(page) && page >= 1 && page <= totalPages) {
                        currentPage = page;
                        updatePagination();
                        renderImages();
                        showFeedback(`è·³è½¬åˆ°ç¬¬ ${page} é¡µã€‚`);
                        e.target.value = "";
                    } else {
                        showFeedback("æ— æ•ˆçš„é¡µç ï¼Œè¯·è¾“å…¥æ­£ç¡®çš„æ•°å­—ã€‚", true);
                    }
                }
            });
            // ä¸Šä¸€é¡µ
            window.prevPage = function() {
                if (currentPage > 1) {
                    currentPage--;
                    updatePagination();
                    renderImages();
                }
            };
            // ä¸‹ä¸€é¡µ
            window.nextPage = function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    updatePagination();
                    renderImages();
                }
            };
            // å¯¼å‡ºé€‰ä¸­çš„åª’ä½“é“¾æ¥
            window.exportImages = function() {
                if (selectedIndices.size === 0) {
                    //showFeedback("æ²¡æœ‰é€‰æ‹©ä»»ä½•åª’ä½“é“¾æ¥ã€‚", true);
                    return null;
                }
                const sortedIndices = Array.from(selectedIndices).sort((a, b) => a - b);
                const exported = sortedIndices.map(index => originalImages[index]).join("\n");

                outputTextArea.value = exported;
                // è‡ªåŠ¨é€‰æ‹©å¹¶å¤åˆ¶
                outputTextArea.select();
                //document.execCommand("copy");
                if (selectedIndices.size > 0) {
                    showFeedback("æˆåŠŸå¯¼å‡ºï¼");
                }
                return selectedIndices.size;
            };
            // æ‰¹é‡é€‰æ‹©æ‰€æœ‰å½“å‰é¡µåª’ä½“
            window.selectAll = function() {
               const checkboxes = container.querySelectorAll(".checkbox-container input[type='checkbox']");
               checkboxes.forEach(cb => {
                   if (!cb.checked) {
                       cb.checked = true;
                       selectedIndices.add(parseInt(cb.value));
                   }
               });
               updateExportButton();
               showFeedback("æ‰€æœ‰åª’ä½“é¡¹å·²é€‰ä¸­ã€‚");
               renderImages();
            };
            // æ‰¹é‡å–æ¶ˆé€‰æ‹©æ‰€æœ‰å½“å‰é¡µåª’ä½“
            window.deselectAll = function() {
               const checkboxes = container.querySelectorAll(".checkbox-container input[type='checkbox']");
               checkboxes.forEach(cb => {
                   if (cb.checked) {
                       cb.checked = false;
                       selectedIndices.delete(parseInt(cb.value));
                   }
               });
               updateExportButton();
               showFeedback("æ‰€æœ‰åª’ä½“é¡¹å·²å–æ¶ˆé€‰æ‹©ã€‚");
               renderImages();
            };
            // æœç´¢åŠŸèƒ½
            window.performSearch = function() {
                const query = searchInput.value.trim();
                if (query === "") {
                    showFeedback("è¯·è¾“å…¥å…³é”®è¯æˆ–æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ã€‚", true);
                    return;
                }
                let mode = 'keyword';
                searchModeRadios.forEach(radio => {
                    if (radio.checked) {
                        mode = radio.value;
                    }
                });
                if (mode === 'regex') {
                    try {
                        new RegExp(query); // æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦æœ‰æ•ˆ
                    } catch (e) {
                        showFeedback("æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚", true);
                        return;
                    }
                }
                // è¿‡æ»¤åª’ä½“é¡¹
                let filtered = [];
                if (mode === 'keyword') {
                    filtered = originalImages.reduce((acc, url, index) => {
                        const groupIndex = Math.floor(index / lineSize);
                        if (!acc[groupIndex]) acc[groupIndex] = [];
                        acc[groupIndex].push(url);
                        return acc;
                    }, []).filter(record => record.some(url => url.toLowerCase().includes(query.toLowerCase())));
                } else if (mode === 'regex') {
                    const regex = new RegExp(query, 'i');
                    filtered = originalImages.reduce((acc, url, index) => {
                        const groupIndex = Math.floor(index / lineSize);
                        if (!acc[groupIndex]) acc[groupIndex] = [];
                        acc[groupIndex].push(url);
                        return acc;
                    }, []).filter(record => record.some(url => regex.test(url)));
                }
                images = filtered;
                currentPage = 1;
                totalPages = Math.ceil(images.length / pageSize);
                updatePagination();
                renderImages();
                closeSearch();
                showFeedback(`æœç´¢åå‰©ä½™ ${images.length} ä¸ªè®°å½•ã€‚`);
            };
            // æ¸…ç©ºæœç´¢
            window.clearSearch = function() {
                if (confirm("ç¡®å®šè¦æ¸…ç©ºæœç´¢æ¡ä»¶å¹¶æ¢å¤æ‰€æœ‰åª’ä½“é¡¹å—ï¼Ÿ")) {
                    groupImages(); // é‡æ–°åˆ†ç»„å…¨éƒ¨åª’ä½“é“¾æ¥
                    currentPage = 1;
                    totalPages = Math.ceil(images.length / pageSize);
                    updatePagination();
                    // è®¾ç½® grid-template-columns æ ¹æ® lineSize
                    container.style.gridTemplateColumns = `repeat(${lineSize}, 1fr)`;
                    renderImages();
                    closeSearch();
                    showFeedback("å·²æ¸…ç©ºæœç´¢æ¡ä»¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰åª’ä½“é¡¹ã€‚");
                }
            };
            // æ‰“å¼€æœç´¢æ¨¡æ€æ¡†
            window.openSearch = function() {
                searchModal.style.display = "block";
                searchInput.focus();
            };
            // å…³é—­æœç´¢æ¨¡æ€æ¡†
            window.closeSearch = function() {
                searchModal.style.display = "none";
                searchInput.value = "";
            };
            // æ‰“å¼€commandå¸®åŠ©æ¨¡æ€æ¡†
            window.openCommandHelp = function() {
                commandModal.style.display = "block";
            };
            // å…³é—­å¸®åŠ©æ¨¡æ€æ¡†
            window.closeCommandHelp = function() {
                commandModal.style.display = "none";
            };
            // æ‰“å¼€å¸®åŠ©æ¨¡æ€æ¡†
            window.openHelp = function() {
                helpModal.style.display = "block";
            };
            // å…³é—­å¸®åŠ©æ¨¡æ€æ¡†
            window.closeHelp = function() {
                helpModal.style.display = "none";
            };
            // è‡ªåŠ¨ä¸»é¢˜æ£€æµ‹å’Œåº”ç”¨
            function applyAutomaticTheme() {
                const savedTheme = localStorage.getItem("theme");
                if (savedTheme) {
                    document.body.classList.remove("light-theme", "dark-theme");
                    document.body.classList.add(`${savedTheme}-theme`);
                } else {
                    const hour = new Date().getHours();
                    if (hour >= 19 || hour < 6) {
                        document.body.classList.add("dark-theme");
                    } else {
                        document.body.classList.add("light-theme");
                    }
                }
            }
            // ä¸»é¢˜åˆ‡æ¢å‡½æ•°
            window.toggleTheme = function() {
                const body = document.body;
                body.classList.toggle("dark-theme");
                body.classList.toggle("light-theme");
                // ä¿å­˜ç”¨æˆ·é€‰æ‹©åˆ° localStorage
                if (body.classList.contains("dark-theme")) {
                    localStorage.setItem("theme", "dark");
                } else {
                    localStorage.setItem("theme", "light");
                }
                showFeedback("ä¸»é¢˜å·²åˆ‡æ¢ã€‚");
            };
            // æ›´æ–°åˆ†é¡µæ˜¾ç¤º
            function updatePagination() {
                currentSpan.textContent = currentPage;
                totalSpan.textContent = totalPages;
            }
            // æ›´æ–°å¯¼å‡ºæŒ‰é’®æ–‡æœ¬
            function updateExportButton() {
                if (selectedIndices.size > 0) {
                    exportButton.innerHTML = `å¯¼å‡ºé€‰ä¸­é“¾æ¥ (${selectedIndices.size})`;
                    exportButton.disabled = false;
                } else {
                    exportButton.innerHTML = 'å¯¼å‡ºé€‰ä¸­é“¾æ¥';
                    exportButton.disabled = true;
                }
            }
            // æ£€æŸ¥æ˜¯å¦ä¸ºJSONå­—ç¬¦ä¸²
            function isJsonString(str) {
                try {
                    const parsed = JSON.parse(str);
                    return !(typeof parsed === 'number' && !isNaN(parsed));
                } catch (e) {
                    return false;
                }
                return true;
            }
            // æ£€æŸ¥æ˜¯å¦ä¸ºè§†é¢‘æ–‡ä»¶
            function isVideo(url) {
                // å…è®¸è§†é¢‘URLæœ«å°¾æœ‰æŸ¥è¯¢å‚æ•°
                return /\.(mp4|webm|ogg)(\?.*)?$/i.test(url);
            }
            // æ£€æŸ¥æ˜¯å¦ä¸ºéŸ³é¢‘æ–‡ä»¶
            function isAudio(url) {
                return /\.(mp3|wav|aac)(\?.*)?$/i.test(url);
            }
            // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
            function isImage(url) {
                return /\.(jpg|jpeg|png|gif|bmp|webp)(\?.*)?$/i.test(url);
            }
            // æ˜¾ç¤ºåé¦ˆæ¶ˆæ¯
            function showFeedback(message, isError = false) {
                feedbackDiv.textContent = message;
                feedbackDiv.classList.remove("error");
                if (isError) {
                    feedbackDiv.classList.add("error");
                }
                feedbackDiv.classList.add("show");
                // åœ¨3ç§’åéšè—åé¦ˆæ¶ˆæ¯
                setTimeout(() => {
                    feedbackDiv.classList.remove("show");
                }, 3000);
            }
            // åˆå§‹åŒ–é¡µé¢
            document.addEventListener("DOMContentLoaded", () => {
                // è‡ªåŠ¨ä¸»é¢˜æ£€æµ‹å’Œåº”ç”¨
                applyAutomaticTheme();
                // è®¾ç½® grid-template-columns æ ¹æ® lineSize
                container.style.gridTemplateColumns = `repeat(${lineSize}, 1fr)`;
                // é‡æ–°è®¡ç®—æ€»é¡µæ•°
                totalPages = Math.ceil(images.length / pageSize);
                // æ›´æ–°åˆ†é¡µæ˜¾ç¤º
                updatePagination();
                // æ¸²æŸ“åª’ä½“
                renderImages();
            });
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(event) {
                if (event.target.tagName.toLowerCase() === 'input' || event.target.tagName.toLowerCase() === 'textarea') {
                    return; // ä¸åœ¨è¾“å…¥æ¡†æ—¶æ‰å“åº”
                }
                if (event.key === 'ArrowLeft') { // å·¦ç®­å¤´é”®
                    prevPage();
                } else if (event.key === 'ArrowRight') { // å³ç®­å¤´é”®
                    nextPage();
                }
            });
            // è·å–æµ®åŠ¨å¼¹å‡ºæ¡†çš„å…ƒç´ 
            const popup = document.getElementById("popup");
            const popupMediaContainer = document.querySelector("#popup .popup-media-container");
            let currentPopupMedia = null;
            let popupTimeout;
            // æ˜¾ç¤ºæµ®åŠ¨å¼¹å‡ºæ¡†å‡½æ•°
            function showPopup(mediaItem, mediaElement, url) {
                // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
                popupMediaContainer.innerHTML = "";

                // æ ¹æ®åª’ä½“ç±»å‹åˆ›å»ºå…‹éš†å…ƒç´ 
                let clonedMedia;
                if (mediaElement.querySelector('video')) {
                    const video = mediaElement.querySelector('video');
                    clonedMedia = document.createElement('video');
                    clonedMedia.src = video.src;
                    clonedMedia.autoplay = true;
                    clonedMedia.muted = false;
                    clonedMedia.loop = true;
                    clonedMedia.className = "media-content";
                    clonedMedia.setAttribute("aria-label", "Video content");
                } else if (mediaElement.tagName.toLowerCase() === 'img') {
                    clonedMedia = document.createElement('img');
                    clonedMedia.src = mediaElement.src;
                    clonedMedia.className = "media-content";
                    clonedMedia.alt = "å›¾ç‰‡å†…å®¹";
                } else {
                    return; // ä»…å¯¹è§†é¢‘å’Œå›¾ç‰‡å¯ç”¨å¼¹å‡ºæ¡†
                }
                popupMediaContainer.appendChild(clonedMedia);

                // è·å–åŸå§‹åª’ä½“é¡¹çš„ä½ç½®
                const rect = mediaItem.getBoundingClientRect();
                const popupWidth = 500;
                const padding = 10; // è·ç¦»è¾¹ç¼˜çš„è·ç¦»

                // è®¡ç®—å¼¹å‡ºæ¡†çš„ä½ç½®
                let popupTop = rect.top + window.scrollY;
                let popupLeft = rect.right + padding + window.scrollX; // é»˜è®¤åœ¨å³ä¾§æ˜¾ç¤º
                let arrowClass = 'arrow-left'; // é»˜è®¤ç®­å¤´æŒ‡å‘å·¦

                // å¦‚æœå¼¹å‡ºæ¡†è¶…å‡ºçª—å£å³ä¾§è¾¹ç•Œï¼Œåˆ™æ˜¾ç¤ºåœ¨å·¦ä¾§
                if (popupLeft + popupWidth > window.innerWidth) {
                    popupLeft = rect.left - popupWidth - padding + window.scrollX;
                    arrowClass = 'arrow-right'; // ç®­å¤´æŒ‡å‘å³
                }

                // è®¾ç½®å¼¹å‡ºæ¡†ä½ç½®
                popup.style.top = `${popupTop}px`;
                popup.style.left = `${popupLeft}px`;

                // è®¾ç½®ç®­å¤´æ–¹å‘
                popup.classList.remove('arrow-left', 'arrow-right');
                popup.classList.add(arrowClass);

                // æ˜¾ç¤ºå¼¹å‡ºæ¡†
                popup.classList.add("show");

                // è®°å½•å½“å‰å¼¹å‡ºçš„åª’ä½“
                currentPopupMedia = {
                    mediaItem,
                    mediaElement: clonedMedia
                };
            }
            // éšè—æµ®åŠ¨å¼¹å‡ºæ¡†å‡½æ•°
            function hidePopup() {
                popup.classList.remove("show");
                popup.classList.remove("arrow-left", "arrow-right"); // ç§»é™¤ç®­å¤´ç±»
                popupMediaContainer.innerHTML = "";
                currentPopupMedia = null;
            }
            // è¾…åŠ©å‡½æ•°ï¼šåˆ‡æ¢é€‰æ‹©çŠ¶æ€
            function toggleSelection(mediaItem, index, isSelected) {
               if (isSelected) {
                   selectedIndices.add(index);
                   mediaItem.classList.add("selected");
               } else {
                   selectedIndices.delete(index);
                   mediaItem.classList.remove("selected");
               }
               updateExportButton();
            }
            // ä¿®æ”¹åçš„ createMediaItem å‡½æ•°
            function createMediaItem(url, index) {
                const div = document.createElement("div");
                div.className = "media-item";
                let mediaElement;
                let audioButton = null;

                if (isJsonString(url)) {
                    try {
                        const jsonObj = JSON.stringify(JSON.parse(url), null, 2) + '\n\n'; // æ ¼å¼åŒ–JSONå¹¶æ¢è¡Œ
                        mediaElement = createTextContent(jsonObj);
                    } catch (e) {
                        mediaElement = createTextContent(url); // å¦‚æœJSONè§£æå¤±è´¥ï¼Œåˆ™æ˜¾ç¤ºåŸæ–‡æœ¬
                    }
                } else if (isVideo(url)) {
                    const videoContainer = document.createElement("div");
                    videoContainer.className = "video-container";
                    videoContainer.style.position = "relative";
                    const video = createVideo(url); // ä½¿ç”¨ä¿®æ”¹åçš„ createVideo å‡½æ•°
                    videoContainer.appendChild(video);
                    audioButton = createAudioButton(video);
                    videoContainer.appendChild(audioButton);
                    mediaElement = videoContainer;
                    addZoomFunctionality(div, mediaElement); // ä¼ å…¥å…·ä½“çš„åª’ä½“å…ƒç´ 
                } else if (isImage(url)) {
                    mediaElement = createImage(url);
                    addZoomFunctionality(div, mediaElement); // ä¼ å…¥å…·ä½“çš„åª’ä½“å…ƒç´ 
                } else if (isAudio(url)) {
                    mediaElement = createAudio(url);
                } else {
                    mediaElement = createTextContent(url);
                }

                // å¤é€‰æ¡†å®¹å™¨
                const checkboxContainer = document.createElement("div");
                checkboxContainer.className = "checkbox-container";
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.value = index; // è®¾ç½®ä¸ºç´¢å¼•
                checkbox.setAttribute("aria-label", "é€‰æ‹©åª’ä½“");
                // åˆå§‹åŒ–å¤é€‰æ¡†çŠ¶æ€
                if (selectedIndices.has(index)) {
                    checkbox.checked = true;
                    div.classList.add("selected");
                }
                // å¤é€‰æ¡†äº‹ä»¶å¤„ç†
                checkbox.addEventListener("click", (e) => {
                    e.stopPropagation();
                    toggleSelection(div, index, checkbox.checked);
                });
                checkboxContainer.appendChild(checkbox);
                div.appendChild(mediaElement);
                div.appendChild(checkboxContainer);
                // åª’ä½“å…ƒç´ ç‚¹å‡»äº‹ä»¶ï¼Œåˆ‡æ¢å¤é€‰æ¡†
                mediaElement.addEventListener("click", () => {
                    const isChecked = !checkbox.checked;
                    checkbox.checked = !checkbox.checked;
                    toggleSelection(div, index, isChecked);
                });
                // ä»…å¯¹å›¾ç‰‡å’Œè§†é¢‘æ·»åŠ æ‚¬åœå¼¹å‡ºæ¡†
                if (isImage(url) || isVideo(url)) {
                    // æ”¾å¤§åŠŸèƒ½å·²ç»é€šè¿‡ addZoomFunctionality å¤„ç†
                }
                return div;
            }


            function addZoomFunctionality(container, mediaElement) {
                const magnifierBox = document.createElement('div');
                magnifierBox.className = 'magnifier-box';
                container.appendChild(magnifierBox);

                const zoomBox = document.createElement('div');
                zoomBox.className = 'zoom-box';
                document.body.appendChild(zoomBox);

                const canvas = document.createElement('canvas');
                canvas.width = 400;
                canvas.height = 400;
                zoomBox.appendChild(canvas);

                let naturalWidth, naturalHeight;

                if (mediaElement.tagName.toLowerCase() === 'img') {
                    naturalWidth = mediaElement.naturalWidth;
                    naturalHeight = mediaElement.naturalHeight;
                    if (naturalWidth === 0 || naturalHeight === 0) {
                        mediaElement.addEventListener('loadedmetadata', () => {
                            naturalWidth = mediaElement.naturalWidth;
                            naturalHeight = mediaElement.naturalHeight;
                        });
                    }
                } else if (mediaElement.tagName.toLowerCase() === 'div') {
                    mediaElement = mediaElement.querySelector('video');
                    naturalWidth = mediaElement.videoWidth;
                    naturalHeight = mediaElement.videoHeight;
                    if (naturalWidth === 0 || naturalHeight === 0) {
                        mediaElement.addEventListener('loadedmetadata', () => {
                            naturalWidth = mediaElement.videoWidth;
                            naturalHeight = mediaElement.videoHeight;
                        });
                    }
                }

                function throttle(func, limit) {
                    let lastFunc;
                    let lastRan;
                    return function(...args) {
                        const context = this;
                        if (!lastRan) {
                            func.apply(context, args);
                            lastRan = Date.now();
                        } else {
                            clearTimeout(lastFunc);
                            lastFunc = setTimeout(function() {
                                if ((Date.now() - lastRan) >= limit) {
                                    func.apply(context, args);
                                    lastRan = Date.now();
                                }
                            }, limit - (Date.now() - lastRan));
                        }
                    }
                }

                const sourceWidth = 60;
                const sourceHeight = 60;

                let isZoomActive = false;
                let isMouseHoverMedia = false;
                let animationFrameId;
                let lastMouseEvent = null;
                let hideTimeout;

                const updateZoom = () => {
                    if (!isZoomActive) return;

                    const e = lastMouseEvent;
                    if (!e) {
                        animationFrameId = requestAnimationFrame(updateZoom);
                        return;
                    }

                    const rect = mediaElement.getBoundingClientRect();

                    if ((mediaElement.tagName.toLowerCase() === 'video') && (naturalWidth === 0 || naturalHeight === 0)) {
                        animationFrameId = requestAnimationFrame(updateZoom);
                        return;
                    }

                    /////
                    var container = mediaElement.parentElement; // è·å–å®¹å™¨å…ƒç´ 
                    if (naturalWidth === 0 || naturalHeight === 0) {
                        if (mediaElement.tagName.toLowerCase() === 'img') {
                            naturalWidth = mediaElement.naturalWidth;
                            naturalHeight = mediaElement.naturalHeight;
                        } else if (mediaElement.tagName.toLowerCase() === 'video') {
                            naturalWidth = mediaElement.videoWidth;
                            naturalHeight = mediaElement.videoHeight;
                        }
                    }
                    // è·å–åŸå›¾å°ºå¯¸
                    var originalWidth = naturalWidth;
                    var originalHeight = naturalHeight;

                    // è·å–ç›®æ ‡å®¹å™¨å°ºå¯¸
                    var containerWidth = container.offsetWidth;
                    var containerHeight = container.offsetHeight;

                    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                    var scaleWidth = containerWidth / naturalWidth;
                    var scaleHeight = containerHeight / naturalHeight;
                    var scale = Math.min(scaleWidth, scaleHeight); // ä½¿ç”¨è¾ƒå°çš„æ¯”ä¾‹ä»¥ç¡®ä¿ä¸è¶…å‡ºå®¹å™¨

                    // è®¡ç®—ç¼©æ”¾åçš„å°ºå¯¸
                    var scaledWidth = originalWidth * scale;
                    var scaledHeight = originalHeight * scale;

                    // ç¡®å®šç¼©æ”¾åçš„åæ ‡
                    var media_x = (containerWidth - scaledWidth) // 2;
                    var media_y = (containerHeight - scaledHeight) // 2;
                    console.log(`Position X: ${media_x}, Position Y: ${media_y}, containerWidth: ${containerWidth}, containerHeight: ${containerHeight}`);

                    /////

                    const scaleX = naturalWidth / rect.width;
                    const scaleY = naturalHeight / rect.height;

                    // è·å–é¼ æ ‡åœ¨æ˜¾ç¤ºåŒºåŸŸçš„åæ ‡
                    let x = (e.clientX - rect.left); // åœ¨mediaä¸­çš„åæ ‡
                    let y = (e.clientY - rect.top);

                    x = x * scaleX;
                    y = y * scaleY;

                    x = x  + (2*media_x/naturalWidth*x- media_x);
                    y = y + (2*media_y/naturalHeight*y- media_y);

                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    try {
                        ctx.drawImage(
                            mediaElement,
                            x - (sourceWidth*2 * scaleX / 2), y - (sourceHeight*2 * scaleY / 2), sourceWidth*2 * scaleX, sourceHeight*2 * scaleX,
                            0, 0, canvas.width, canvas.height
                        );
                    } catch (error) {
                        console.error('ç»˜åˆ¶åˆ°ç”»å¸ƒæ—¶å‡ºé”™:', error);
                    }
                    console.log(naturalWidth, naturalHeight, rect.width, rect.height, media_x, media_y, x, y);

                    const displayX = e.clientX - rect.left - (sourceWidth / 2);
                    const displayY = e.clientY - rect.top - (sourceHeight / 2);

                    magnifierBox.style.left = `${displayX}px`;
                    magnifierBox.style.top = `${displayY}px`;
                    magnifierBox.style.display = 'block';

                    let zoomBoxLeft = e.clientX + 32;
                    let zoomBoxTop = e.clientY - 200;

                    if (zoomBoxLeft + 400 > window.innerWidth) {
                        zoomBoxLeft = e.clientX - 420;
                    }
                    if (zoomBoxTop < 0) {
                        zoomBoxTop = 0;
                    } else if (zoomBoxTop + 400 > window.innerHeight) {
                        zoomBoxTop = window.innerHeight - 400;
                    }

                    zoomBox.style.left = `${zoomBoxLeft}px`;
                    zoomBox.style.top = `${zoomBoxTop}px`;
                    zoomBox.style.display = 'block';

                    animationFrameId = requestAnimationFrame(updateZoom);
                }

                const handleMouseMove = throttle((e) => {
                    clearTimeout(hideTimeout);
                    lastMouseEvent = e;

                    if (e.metaKey) {
                        if (!isZoomActive) {
                            isZoomActive = true;
                            updateZoom();
                        }
                    } else {
                        if (isZoomActive) {
                            isZoomActive = false;
                            magnifierBox.style.display = 'none';
                            zoomBox.style.display = 'none';
                            cancelAnimationFrame(animationFrameId);
                        }
                    }
                }, 1);

                mediaElement.addEventListener('mousemove', handleMouseMove);

                const hideZoom = () => {
                    if (isZoomActive) {
                        isZoomActive = false;
                        magnifierBox.style.display = 'none';
                        zoomBox.style.display = 'none';
                        cancelAnimationFrame(animationFrameId);
                    }
                }

                mediaElement.addEventListener('mouseleave', hideZoom);

                document.addEventListener('keyup', (e) => {
                    if (e.key === 'Meta') {
                        hideZoom();

                    }
                });
            }
            const commandIcon = document.querySelector('.command-icon');

            document.addEventListener('keydown', function(e) {
                if (e.metaKey) {
                    commandIcon.classList.add('active');
                }
            });

            document.addEventListener('keyup', function(e) {
                if (e.key === 'Meta') {
                    commandIcon.classList.remove('active');
                }
            });
            // ç¡®ä¿åªæ·»åŠ ä¸€æ¬¡ç›‘å¬å™¨
            let isCommandPressed = false;

            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­å¼¹å‡ºæ¡†ï¼ˆå¯é€‰ï¼‰
            document.addEventListener('click', function(event) {
                if (!popup.contains(event.target)) {
                    hidePopup();
                }
            });


            // ä¿å­˜å½“å‰é¡µé¢åŠŸèƒ½
            window.savePage = function() {
                // è·å–å½“å‰çš„åª’ä½“é“¾æ¥å’Œé€‰æ‹©çŠ¶æ€
                const data = originalImages.map(url => ({
                    url: url,
                    selected: selectedIndices.has(originalImages.indexOf(url))
                }));

                // è·å–å½“å‰é¡µé¢çš„HTMLå†…å®¹
                let currentHtml = document.documentElement.outerHTML;

                // æ›¿æ¢ JavaScript å˜é‡çš„åˆå§‹åŒ–å†…å®¹
                currentHtml = currentHtml
                    .replace(/let originalImages = \[\];/, `let originalImages = ${JSON.stringify(originalImages, null, 4)};`)
                    .replace(/let images = \[\];/, `let images = ${JSON.stringify(images, null, 4)};`)
                    .replace(/let currentPage = \d+;/, `let currentPage = ${currentPage};`)
                    .replace(/let pageSize = \d+;/, `let pageSize = ${pageSize};`)
                    .replace(/let lineSize = \d+;/, `let lineSize = ${lineSize};`)
                    .replace(/const selectedIndices = new Set\(\);/, `const selectedIndices = new Set(${JSON.stringify(Array.from(selectedIndices))});`);

                // è½¬ä¹‰ URL åˆ—è¡¨ä¸­çš„ç‰¹æ®Šå­—ç¬¦
                const escapedUrls = originalImages.map(url => {
                    return url.replace(/&/g, "&amp;")
                              .replace(/</g, "&lt;")
                              .replace(/>/g, "&gt;")
                              .replace(/"/g, "&quot;")
                              .replace(/'/g, "&#039;");
                }).join("\n");

                // æ›¿æ¢ <textarea id="input"> çš„å†…å®¹ä¸ºåŸå§‹çš„ URL åˆ—è¡¨
                currentHtml = currentHtml.replace(
                    /<textarea\s+id=["']input["'][^>]*>[\s\S]*?<\/textarea>/,
                    `<textarea id="input" placeholder="æ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œä¾‹å¦‚ï¼š
            https://example.com/image1.jpg
            https://example.com/video1.mp4
            https://example.com/audio1.mp3
            https://example.com/data1.json">${escapedUrls}</textarea>`
                );

                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([currentHtml], { type: "text/html" });
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "saved_demo_page.html";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showFeedback("é¡µé¢å·²ä¿å­˜ä¸º saved_demo_page.html");
            };
        })();
    </script>
</body>
</html>
